exports.id=7861,exports.ids=[7360,7861],exports.modules={10781:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,54160,23)),Promise.resolve().then(c.t.bind(c,31603,23)),Promise.resolve().then(c.t.bind(c,68495,23)),Promise.resolve().then(c.t.bind(c,75170,23)),Promise.resolve().then(c.t.bind(c,77526,23)),Promise.resolve().then(c.t.bind(c,78922,23)),Promise.resolve().then(c.t.bind(c,29234,23)),Promise.resolve().then(c.t.bind(c,12263,23)),Promise.resolve().then(c.bind(c,82146))},13361:(a,b,c)=>{"use strict";c.d(b,{Providers:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call Providers() from the server but Providers is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/emartinez/Documents/JEG/src/components/Providers.tsx","Providers")},15517:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,81170,23)),Promise.resolve().then(c.t.bind(c,23597,23)),Promise.resolve().then(c.t.bind(c,36893,23)),Promise.resolve().then(c.t.bind(c,89748,23)),Promise.resolve().then(c.t.bind(c,6060,23)),Promise.resolve().then(c.t.bind(c,7184,23)),Promise.resolve().then(c.t.bind(c,69576,23)),Promise.resolve().then(c.t.bind(c,73041,23)),Promise.resolve().then(c.t.bind(c,51384,23))},24440:(a,b,c)=>{Promise.resolve().then(c.bind(c,58305)),Promise.resolve().then(c.bind(c,13361))},26467:(a,b,c)=>{"use strict";c.d(b,{Providers:()=>f});var d=c(21124),e=c(57461);function f({children:a,session:b}){return(0,d.jsx)(e.SessionProvider,{session:b,children:a})}},34168:(a,b,c)=>{Promise.resolve().then(c.bind(c,92091)),Promise.resolve().then(c.bind(c,26467))},51472:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>j,metadata:()=>i,viewport:()=>h});var d=c(75338);c(61135);var e=c(58305),f=c(13361),g=c(67360);let h={width:"device-width",initialScale:1,themeColor:"#0b1020"},i={title:"JEG Soluciones",description:"Gesti\xf3n de proyectos y mantenimiento - JEG Soluciones",icons:{icon:"/favicon-32.png",apple:"/Logo%20JEG.jpg",shortcut:"/favicon.ico"}};async function j({children:a}){let b=await (0,g.auth)();return(0,d.jsx)("html",{lang:"es",children:(0,d.jsx)("body",{className:"font-sans antialiased",children:(0,d.jsx)("div",{className:"app-bg min-h-screen",children:(0,d.jsxs)(f.Providers,{session:b,children:[b?(0,d.jsx)(e.Navbar,{}):null,(0,d.jsx)("main",{className:"mx-auto max-w-7xl px-3 sm:px-6 py-4 sm:py-8",children:a})]})})})})}},58305:(a,b,c)=>{"use strict";c.d(b,{Navbar:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call Navbar() from the server but Navbar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/emartinez/Documents/JEG/src/components/Navbar.tsx","Navbar")},61135:()=>{},67360:(a,b,c)=>{"use strict";c.d(b,{J:()=>j,N:()=>n,auth:()=>o});var d=c(28120),e=c(7028),f=c(36112),g=c(52963),h=c(74438),i=c(86692);let j={ADMIN:"ADMIN",COORDINADOR:"COORDINADOR",VOLUNTARIO:"VOLUNTARIO"},k=f.Ik({email:f.Yj().email(),password:f.Yj().min(6)});async function l(a){if(process.env.MONGODB_URI){await (0,i.N)();let{default:b}=await c.e(7812).then(c.bind(c,77812)),d=await b.findOne({email:a}).lean();return!d||Array.isArray(d)?null:{id:String(d._id),name:d.name,email:d.email,passwordHash:d.passwordHash,role:d.role,emailVerified:+!!d.emailVerified}}return h.db.prepare("SELECT id, name, email, password_hash as passwordHash, role, email_verified as emailVerified FROM users WHERE email = ?").get(a)??null}async function m(a){if(process.env.MONGODB_URI){await (0,i.N)();let{default:b}=await c.e(7812).then(c.bind(c,77812)),d=await b.findOne({email:a}).select({role:1,emailVerified:1,name:1,settings:1}).lean();return{role:d?.role,approved:!!d?.emailVerified,name:d?.name??null,settings:d?.settings??{}}}let b=h.db.prepare("SELECT name, role, email_verified as emailVerified FROM users WHERE email = ?").get(a);return{role:b?.role??null,approved:b?.emailVerified===1,name:b?.name??null,settings:{}}}let n={session:{strategy:"jwt"},pages:{signIn:"/signin"},providers:[(0,d.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},authorize:async a=>{let b=k.safeParse(a);if(!b.success)return null;let{email:c,password:d}=b.data,f=await l(c);if(!f||!f.passwordHash||!await (0,e.UD)(d,f.passwordHash))return null;if(1!==f.emailVerified)throw Error("PendienteAprobacion");let{role:g,name:h,settings:i}=await m(c);return{id:f.id,email:f.email,name:h??f.name??void 0,role:g??f.role??j.VOLUNTARIO,settings:i??{}}}})],callbacks:{async jwt({token:a,user:b}){if(b&&(a.role=b.role??a.role??j.VOLUNTARIO,a.name=b.name??a.name,a.settings=b.settings??a.settings??{}),a?.email)try{let{role:b,approved:c,name:d,settings:e}=await m(a.email);a.role=b??a.role??j.VOLUNTARIO,a.approved=c??!1,a.name=d??a.name,a.settings=e??a.settings??{}}catch{}return a},session:({session:a,token:b})=>(a.user=a.user??{},a.user.role=b.role??j.VOLUNTARIO,a.user.approved=b.approved??!1,b&&b.name&&(a.user.name=String(b.name)),a.user.settings=b.settings??{},a)}};function o(){return(0,g.getServerSession)(n)}},70440:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>e});var d=c(97523);let e=async a=>[{type:"image/x-icon",sizes:"16x16",url:(0,d.fillMetadataSegment)(".",await a.params,"favicon.ico")+""}]},74438:(a,b,c)=>{"use strict";c.d(b,{db:()=>j});var d=c(87550),e=c.n(d),f=c(33873),g=c.n(f),h=c(7028);let i=g().join(process.cwd(),"data","app.db"),j=new(e())(i);j.pragma("journal_mode = WAL"),j.exec(`
CREATE TABLE IF NOT EXISTS users (
  id TEXT PRIMARY KEY,
  name TEXT,
  email TEXT UNIQUE,
  password_hash TEXT,
  role TEXT DEFAULT 'VOLUNTARIO',
  email_verified INTEGER DEFAULT 0,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS volunteers (
  id TEXT PRIMARY KEY,
  nombre TEXT NOT NULL,
  apellido TEXT NOT NULL,
  email TEXT,
  telefono TEXT,
  congregacion TEXT,
  a2 INTEGER DEFAULT 0,
  trabajo_altura INTEGER DEFAULT 0,
  created_by TEXT,
  short_id TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS fichas (
  id TEXT PRIMARY KEY,
  titulo TEXT NOT NULL,
  descripcion TEXT,
  prioridad TEXT DEFAULT 'MEDIA',
  estado TEXT DEFAULT 'ABIERTA',
  asignado_a TEXT,
  vencimiento TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);
`);try{j.prepare("ALTER TABLE fichas ADD COLUMN instrucciones TEXT").run()}catch{}try{j.prepare("ALTER TABLE fichas ADD COLUMN notas TEXT").run()}catch{}try{j.prepare("ALTER TABLE fichas ADD COLUMN checklist TEXT").run()}catch{}try{j.prepare("ALTER TABLE fichas ADD COLUMN pdfId TEXT").run()}catch{}try{j.prepare("ALTER TABLE volunteers ADD COLUMN short_id TEXT").run()}catch{}try{j.prepare("ALTER TABLE volunteers ADD COLUMN email TEXT").run()}catch{}try{let a=process.env.ADMIN_EMAIL,b=process.env.ADMIN_PASSWORD,c=process.env.ADMIN_PASSWORD_HASH;if(a&&!j.prepare("SELECT id FROM users WHERE email = ?").get(a)&&(c||b)){let d=c&&c.length>0?c:h.Ay.hashSync(b,10);j.prepare(`INSERT INTO users (id, name, email, password_hash, role, email_verified)
         VALUES (@id, @name, @email, @password_hash, @role, 1)`).run({id:crypto.randomUUID(),name:"Administrador",email:a,password_hash:d,role:"ADMIN"})}}catch(a){}},86692:(a,b,c)=>{"use strict";c.d(b,{N:()=>i,y:()=>k});var d=c(56037),e=c.n(d),f=c(7028);let g=process.env.MONGODB_URI||"";g||console.warn("MONGODB_URI no definido. Configura .env.local");let h=global;async function i(){return h._mongoose||(h._mongoose={conn:null,promise:null}),h._mongoose.conn||(h._mongoose.promise||(h._mongoose.promise=e().connect(g,{bufferCommands:!1}).then(async a=>(await j(),a))),h._mongoose.conn=await h._mongoose.promise),h._mongoose.conn}async function j(){try{let{default:a}=await c.e(7812).then(c.bind(c,77812)),b=process.env.ADMIN_EMAIL,d=process.env.ADMIN_PASSWORD,e=process.env.ADMIN_PASSWORD_HASH;if(!b||!d&&!e||await a.findOne({email:b}).lean())return;let g=e&&e.length>0?e:f.Ay.hashSync(d,10);await a.create({name:"Administrador",email:b,passwordHash:g,role:"ADMIN",emailVerified:!0}),console.log("Seeded ADMIN user in MongoDB")}catch(a){console.warn("Admin seed skipped:",a.message)}}function k(){return 1===e().connection.readyState}},92091:(a,b,c)=>{"use strict";c.d(b,{Navbar:()=>m});var d=c(21124),e=c(3991),f=c.n(e),g=c(42378),h=c(57461),i=c(38301),j=c(23312);let k=[{href:"/dashboard",label:"\uD83C\uDFE0 Dashboard"},{href:"/voluntarios",label:"\uD83E\uDD1D Supervisores"},{href:"/tareas",label:"\uD83D\uDEE0️ Tareas"},{href:"/plan-semanal",label:"\uD83D\uDCC5 Plan semanal"},{href:"/usuarios",label:"\uD83D\uDC65 Usuarios"},{href:"/proyectos",label:"\uD83D\uDCC1 Proyectos"},{href:"/actividad",label:"\uD83D\uDCF0 Actividad"}];function l({open:a,onClose:b}){let c=(0,g.usePathname)();(0,h.useSession)();let[e,l]=(0,i.useState)(!1);if(!e)return null;let m=(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"fixed inset-0 bg-black/50 z-[1000] transition-opacity "+(a?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),onClick:b,"aria-hidden":!0}),(0,d.jsx)("aside",{id:"app-sidebar",className:"fixed z-[1001] top-0 left-0 h-screen w-72 sm:w-80 bg-[color:var(--surface)] border-r border-[color:var(--border)] shadow-xl transform transition-transform "+(a?"translate-x-0":"-translate-x-full"),"aria-label":"Sidebar",children:(0,d.jsxs)("div",{className:"h-full flex flex-col",children:[(0,d.jsx)("div",{className:"h-14 flex items-center px-4 border-b border-[color:var(--border)] font-semibold text-white",children:"Mantenimiento SR"}),(0,d.jsx)("nav",{className:"p-2 overflow-y-auto overscroll-contain flex-1",children:(0,d.jsx)("ul",{className:"space-y-1",children:k.map(a=>{let e=c===a.href;return(0,d.jsx)("li",{children:(0,d.jsx)(f(),{href:a.href,className:"flex items-center gap-2 px-3 py-2 rounded text-sm "+(e?"bg-white/10 text-white":"text-[color:var(--foreground)]/90 hover:bg-white/5"),onClick:b,children:(0,d.jsx)("span",{children:a.label})})},a.href)})})}),(0,d.jsx)("div",{className:"p-3 border-t border-[color:var(--border)] bg-[color:var(--surface)]",children:(0,d.jsx)("button",{className:"w-full btn btn-ghost",onClick:()=>{let a=process.env.NEXT_PUBLIC_BASE_URL||void 0;(0,h.signOut)({callbackUrl:a?`${a}/`:"/"}),b()},children:"Salir"})})]})})]});return(0,j.createPortal)(m,document.body)}function m(){(0,g.usePathname)();let a=(0,h.useSession)(),b=a.data?.user??{},[c,e]=(0,i.useState)(!1);return"authenticated"!==a.status?null:(0,d.jsxs)("header",{className:"sticky top-0 z-40 bg-gradient-to-r from-[color:var(--brand)] via-[color:var(--info)] to-[color:var(--warning)] text-white shadow-md",children:[(0,d.jsxs)("div",{className:"mx-auto max-w-7xl px-3 sm:px-4 py-2 sm:py-3 flex items-center gap-2 sm:gap-3",children:[(0,d.jsx)("button",{className:"p-2 sm:p-2.5 rounded border border-white/30 inline-flex items-center justify-center hover:bg-white/10 touch-manipulation",onClick:()=>e(a=>!a),"aria-label":c?"Cerrar men\xfa":"Abrir men\xfa","aria-controls":"app-sidebar","aria-expanded":c,children:(0,d.jsxs)("span",{className:"relative block w-6 h-4 text-white",children:[(0,d.jsx)("span",{className:`absolute left-0 top-0 h-0.5 w-6 bg-current transition-transform duration-300 ${c?"translate-y-1.5 rotate-45":""}`}),(0,d.jsx)("span",{className:`absolute left-0 top-1/2 h-0.5 w-6 bg-current -translate-y-1/2 transition-opacity duration-300 ${c?"opacity-0":"opacity-100"}`}),(0,d.jsx)("span",{className:`absolute left-0 bottom-0 h-0.5 w-6 bg-current transition-transform duration-300 ${c?"-translate-y-1.5 -rotate-45":""}`})]})}),(0,d.jsxs)(f(),{href:"/dashboard",className:"font-semibold tracking-tight text-white text-sm sm:text-base flex items-center gap-2",children:[(0,d.jsx)("img",{src:"/Logo%20JEG.jpg",alt:"JEG Soluciones",className:"h-8 sm:h-10 block"}),(0,d.jsx)("span",{className:"sr-only",children:"JEG Soluciones"})]}),(0,d.jsxs)("div",{className:"ml-auto flex items-center gap-2 sm:gap-3 text-xs sm:text-sm",children:[b.name?(0,d.jsx)("span",{className:"hidden sm:inline text-white/90",children:b.name}):null,(0,d.jsx)(f(),{href:"/perfil",className:"btn btn-ghost",children:"Perfil"})]})]}),(0,d.jsx)(l,{open:c,onClose:()=>e(!1)})]})}}};