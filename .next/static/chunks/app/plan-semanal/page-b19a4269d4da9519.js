(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1456],{4165:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>n});var r=s(5155),t=s(2115);let i=[{semana:1,titulo:"1ra SEMANA DEL MES - INTERIOR",tareas:[{area:"Ventanas",descripcion:"Limpiar con agua y un poco de detergente empezando por el exterior incluyendo los protectores de ventanas. Enjuagar con agua limpia cuidando de no mojar los muebles. Limpiar suavemente con papel toalla los cristales. Usar limpiador de cristal o soluci\xf3n de agua con vinagre."},{area:"Paredes",descripcion:"Limpiar con un pa\xf1o limpio y h\xfamedo para quitar el polvo. En manchas o suciedad marcada, lavar con detergente y cuidar la pintura. Limpiar cer\xe1micas de paredes y puertas de cub\xedculos de ba\xf1os."},{area:"Sillas",descripcion:"Limpiar la estructura con pa\xf1o h\xfamedo. Para sillas acolchadas, aspirar y quitar manchas con producto apropiado."},{area:"Pisos",descripcion:"Barrer y trapear con poca agua. No usar cloro. El desinfectante debe disolverse en agua, nunca directamente al piso. Incluir la acera frente a las entradas."}]},{semana:2,titulo:"2da SEMANA DEL MES - EXTERIOR",tareas:[{area:"\xc1rea verde",descripcion:"Podar arbustos y cortar grama. Eliminar partes secas y maleza en \xe1reas de grava. Quitar maleza que venga de vecinos."},{area:"Estacionamiento",descripcion:"Incluye aceras y contenes. Limpiar toda el \xe1rea profundamente. Eliminar manchas de humedad en las aceras."},{area:"Portones",descripcion:"Incluir port\xf3n vehicular y peatonal. Limpiar con agua y detergente. Enjuagar con agua limpia."},{area:"Cuarto de Limpieza",descripcion:"Sacar todo, limpiar y organizar. Desechar equipos y productos inservibles; organizar materiales (escobas, suapers, cubos, papel toalla, etc.)."}]},{semana:3,titulo:"3ra SEMANA DEL MES - INTERIOR",tareas:[{area:"Techo",descripcion:"Con escobill\xf3n para techos, retirar polvo, telara\xf1as e insectos."},{area:"Ventiladores",descripcion:"Con escalera, limpiar aspas con pa\xf1o mojado y seco. Limpiar base del abanico. No trabajar a m\xe1s de 1.8m de altura."},{area:"Muebles",descripcion:"Incluir muebles de plataforma, literatura, tablero y biblioteca. Retirar publicaciones y limpiar con pa\xf1o h\xfamedo y seco. Retirar art\xedculos inservibles o abandonados."},{area:"Cristales",descripcion:"Limpiar espejos de ba\xf1os, cristales de la Sala B y puertas. Usar limpiador de cristal o agua con vinagre."},{area:"Pisos",descripcion:"Barrer y trapear con poca agua. No usar cloro. Desinfectante diluido en agua. Incluir acera frente a entradas."}]},{semana:4,titulo:"4ta SEMANA DEL MES - EXTERIOR/INTERIOR",tareas:[{area:"\xc1rea verde",descripcion:"Podar arbustos y cortar grama. Eliminar partes secas y maleza."},{area:"L\xe1mparas",descripcion:"Remover difusores y limpiar suavemente con pa\xf1o h\xfamedo y seco. Revisar insectos y polvo. Colocar difusores con cuidado."},{area:"Cuarto de M\xe1quina",descripcion:"Sacar todo, limpiar y organizar. No dejar nada que pueda causar o alimentar incendio."}]},{semana:5,titulo:"5ta SEMANA DEL MES",subtitulo:"Si hay quinta semana entre los dos meses, se pueden usar para tareas que no se completaron.",tareas:[]}];function n(){let e=(0,t.useMemo)(()=>new Date,[]),[a,s]=(0,t.useState)(e.getFullYear()),[n,l]=(0,t.useState)(e.getMonth()+1),[o,c]=(0,t.useState)(null),[d,m]=(0,t.useState)([]),[p,u]=(0,t.useState)([]),[h,g]=(0,t.useState)(!1),[x,v]=(0,t.useState)(!1),[y,f]=(0,t.useState)(""),[j,b]=(0,t.useState)("");(0,t.useEffect)(()=>{let e=!1;return(async()=>{g(!0);try{let s=await fetch("/api/plan-semanal?year=".concat(a,"&month=").concat(n),{cache:"no-store"}),r=await s.json();e||(s.ok&&r.item?c(r.item):c({year:a,month:n,empresas:[],asignaciones:[]}))}catch(s){e||c({year:a,month:n,empresas:[],asignaciones:[]})}finally{e||g(!1)}})(),()=>{e=!0}},[a,n]),(0,t.useEffect)(()=>{let e=!1;return(async()=>{try{let a=await fetch("/api/config/empresas/from-voluntarios",{cache:"no-store"});if(!a.ok){let a=await fetch("/api/config/congregaciones/from-voluntarios",{cache:"no-store"}),s=await a.json();e||(m(s.congregaciones||[]),u(s.congregaciones||[]));return}let s=await a.json();e||u(s.empresas||s.congregaciones||[])}catch(e){}})(),()=>{e=!0}},[]);let N=(0,t.useMemo)(()=>{var e;let a=new Map;return null==o||null==(e=o.asignaciones)||e.forEach(e=>{"number"==typeof e.slot&&a.set(e.slot,e)}),a},[o]),E=e=>{b(e),setTimeout(()=>b(""),2e3)},S=async(e,s)=>{if(o)if(N.get(e)){let r=await fetch("/api/plan-semanal/asignar",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({year:a,month:n,slot:e,...s})});c((await r.json()).item),E("Guardado")}else{let r=await fetch("/api/plan-semanal/asignar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({year:a,month:n,slot:e,...s})});c((await r.json()).item),E("Asignado")}},w=async e=>{v(!0);try{let a=await fetch("/api/config/empresas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({empresas:e})});if(!a.ok){let a=await fetch("/api/config/congregaciones",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({congregaciones:e})}),s=await a.json();u(s.empresas||s.congregaciones||[]),m(s.congregaciones||[]),E("Empresas guardadas");return}let s=await a.json();u(s.empresas||[]),m(s.empresas||[]),E("Empresas guardadas")}finally{v(!1)}},C=()=>{let e=y.trim();if(e){if((p||[]).includes(e))return void f("");w([...p||[],e]),f("")}};return(0,t.useMemo)(()=>{let a=e.getFullYear();return[a-1,a,a+1]},[e]),(0,r.jsxs)("section",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Plan semanal"}),(0,r.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Asignaciones por semana."})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("select",{className:"select",value:a,onChange:e=>s(parseInt(e.target.value)),children:[e.getFullYear()-1,e.getFullYear(),e.getFullYear()+1].map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),(0,r.jsx)("select",{className:"select",value:n,onChange:e=>l(parseInt(e.target.value)),children:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Sptiembre","Octubre","Noviembre","Diciembre"].map((e,a)=>(0,r.jsx)("option",{value:a+1,children:e},e))})]})]}),j&&(0,r.jsx)("div",{className:"text-xs",style:{color:"var(--success)"},children:j}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h2",{className:"font-medium",children:"Empresas"}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap items-center",children:[(0,r.jsx)("input",{className:"input",placeholder:"Nueva empresa",value:y,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"===e.key&&C()}}),(0,r.jsx)("button",{className:"btn btn-primary disabled:opacity-50",onClick:C,disabled:x||!y.trim(),children:"Agregar"}),x&&(0,r.jsx)("span",{className:"text-xs text-[color:var(--muted)]",children:"Guardando…"})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(p||[]).map(e=>(0,r.jsxs)("span",{className:"inline-flex items-center gap-2 badge",children:[e,(0,r.jsx)("button",{className:"text-red-500 text-xs hover:underline",onClick:()=>{w(p.filter(a=>a!==e))},title:"Quitar",children:"\xd7"})]},e)),0===(p||[]).length&&(0,r.jsx)("span",{className:"text-xs text-[color:var(--muted)]",children:"A\xfan no hay empresas"})]})]}),(0,r.jsx)("div",{className:"space-y-6",children:[1,2,3,4,5].map(e=>{let a=N.get(e),s=null==a?void 0:a.plantilla,t=s?i.find(e=>e.semana===s):void 0,n=(null==a?void 0:a.tareas)||[],l=!!(s&&(null==a?void 0:a.empresa)&&((null==n?void 0:n.length)||0)>0);return(0,r.jsxs)("div",{className:"card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-semibold",children:["Semana ",e," del mes"]}),t?(0,r.jsxs)("p",{className:"text-xs text-[color:var(--muted)]",children:["Plantilla: ",t.titulo]}):(0,r.jsx)("p",{className:"text-xs text-[color:var(--muted)]",children:"Selecciona la semana de la gu\xeda para esta semana del mes"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,r.jsxs)("select",{className:"select",value:s||"",onChange:async a=>{let s=parseInt(a.target.value);s&&await S(e,{plantilla:s,tareas:(e=>{if(!e)return[];let a=i.find(a=>a.semana===e);return((null==a?void 0:a.tareas)||[]).map(e=>e.area)})(s)})},children:[(0,r.jsx)("option",{value:"",children:"Semana de gu\xeda…"}),i.map(e=>(0,r.jsx)("option",{value:e.semana,children:e.titulo},e.semana))]}),(0,r.jsxs)("select",{className:"select disabled:opacity-60",disabled:!s,value:(null==a?void 0:a.empresa)||"",onChange:async a=>{let s=a.target.value;s&&await S(e,{empresa:s})},children:[(0,r.jsx)("option",{value:"",children:"Asignar empresa…"}),(p||[]).map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!(null==a?void 0:a.completado),disabled:!l,title:l?"Marcar completado":"Selecciona plantilla, empresa y tareas",onChange:async a=>{await S(e,{completado:a.target.checked})}}),"Completado"]})]})]}),t&&(0,r.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:"\xc1reas a realizar"}),(0,r.jsx)("div",{className:"grid sm:grid-cols-2 gap-2 text-sm",children:t.tareas.map(s=>{let t=n.includes(s.area);return(0,r.jsxs)("label",{className:"flex items-start gap-2 rounded px-3 py-2 bg-[color:var(--surface-2)] border border-[color:var(--border)]",children:[(0,r.jsx)("input",{type:"checkbox",className:"mt-1",disabled:!(null==a?void 0:a.empresa),checked:t,onChange:async a=>{let r=new Set(n);a.target.checked?r.add(s.area):r.delete(s.area),await S(e,{tareas:Array.from(r)})}}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-[color:var(--foreground)]",children:s.area}),(0,r.jsx)("div",{className:"text-xs text-[color:var(--muted)] leading-relaxed",children:s.descripcion})]})]},s.area)})})]})]},e)})}),h&&(0,r.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Cargando…"})]})}},8393:(e,a,s)=>{Promise.resolve().then(s.bind(s,4165))}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=8393)),_N_E=e.O()}]);