(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7738],{63:(e,t,a)=>{"use strict";var s=a(7260);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},7165:(e,t,a)=>{Promise.resolve().then(a.bind(a,7413))},7413:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),l=a(63),i=a(1026),r=a(2115);let n=async e=>{let t=await fetch(e);if(!t.ok)return null;let a=await t.text();if(!a)return null;try{return JSON.parse(a)}catch(e){return null}};function c(){let e=(0,l.useParams)(),t=null==e?void 0:e.id,{data:a,mutate:c}=(0,i.Ay)(t?"/api/proyectos/".concat(t):null,n,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshInterval:0}),[o,d]=(0,r.useState)(""),[m,u]=(0,r.useState)(""),[h,x]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[b,f]=(0,r.useState)(!1),[v,j]=(0,r.useState)(null),[N,y]=(0,r.useState)(""),[C,k]=(0,r.useState)({title:"",description:"",category:"",items:[""]}),{data:w,mutate:_}=(0,i.Ay)(p||b?"/api/checklist-templates":null,n,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshInterval:0}),E=(null==a?void 0:a.checklistCategories)||[],P=(null==a?void 0:a.checklist)&&a.checklist.length>0&&0===E.length;async function S(e){try{let a=await fetch("/api/proyectos/".concat(t),{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.text();throw Error(e)}let s=await a.json();await c(s,!1)}catch(e){console.error("Error actualizando proyecto:",e),alert("Error actualizando proyecto: ".concat((null==e?void 0:e.message)||e))}}async function O(){if(!(null==a?void 0:a.checklist))return;let e={title:"Lista general",items:a.checklist,isCollapsed:!1,order:0};await S({checklistCategories:[e],checklist:[]})}async function D(){if(!m.trim())return;let e={title:m.trim(),items:[],isCollapsed:!1,order:E.length};await S({checklistCategories:[...E,e]}),u(""),x(!1)}async function z(e){let t={title:e.title,items:e.items.sort((e,t)=>e.order-t.order).map(e=>({text:e.text,done:!1})),isCollapsed:!1,order:E.length};await S({checklistCategories:[...E,t]});try{await fetch("/api/checklist-templates/".concat(e._id),{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({...e,usageCount:e.usageCount+1})})}catch(e){console.warn("Error actualizando contador de plantilla:",e)}g(!1)}async function A(e,t){let a=E.map(a=>a._id===e?{...a,title:t}:a);await S({checklistCategories:a}),j(null)}async function T(e){let t=E.map(t=>t._id===e?{...t,isCollapsed:!t.isCollapsed}:t);await S({checklistCategories:t})}async function R(e){if(!confirm("\xbfEst\xe1s seguro de que quieres eliminar esta categor\xeda?"))return;let t=E.filter(t=>t._id!==e);await S({checklistCategories:t})}async function F(){if(!C.title.trim())return;let e={title:C.title.trim(),description:C.description.trim(),category:C.category.trim()||"Personalizada",items:C.items.map((e,t)=>({text:e.trim(),order:t})).filter(e=>e.text)};if(0===e.items.length)return void alert("Debes agregar al menos una tarea a la plantilla");try{let t=await fetch("/api/checklist-templates",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error(e)}k({title:"",description:"",category:"",items:[""]}),f(!1),_&&_(),alert("Plantilla creada exitosamente")}catch(e){alert("Error creando plantilla: ".concat((null==e?void 0:e.message)||e))}}async function I(e){if(!o.trim())return;let t=E.map(t=>t._id===e?{...t,items:[...t.items,{text:o.trim(),done:!1}]}:t);await S({checklistCategories:t}),d("")}async function J(e,t){let a=E.map(a=>a._id===e?{...a,items:a.items.map((e,a)=>a===t?{...e,done:!e.done}:e)}:a);await S({checklistCategories:a})}async function q(e,t){let a=E.map(a=>a._id===e?{...a,items:a.items.filter((e,a)=>a!==t)}:a);await S({checklistCategories:a})}let B=E.reduce((e,t)=>e+t.items.length,0),K=E.reduce((e,t)=>e+t.items.filter(e=>e.done).length,0),M=B>0?Math.round(K/B*100):0,L=(null==w?void 0:w.reduce((e,t)=>{let a=t.category||"Otros";return e[a]||(e[a]=[]),e[a].push(t),e},{}))||{};return a?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Lista de verificaci\xf3n"}),(0,s.jsxs)("p",{className:"text-sm text-[color:var(--muted)] mt-1",children:[K," de ",B," tareas completadas (",M,"%)"]})]}),B>0&&(0,s.jsx)("div",{className:"w-32 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:"".concat(M,"%")}})})]}),P&&(0,s.jsx)("div",{className:"card p-4 border-blue-200 bg-blue-50",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("span",{className:"text-blue-600 text-xl",children:"\uD83D\uDCA1"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-medium text-blue-800",children:"Actualizar lista de verificaci\xf3n"}),(0,s.jsx)("p",{className:"text-sm text-blue-600 mt-1",children:"Tienes una lista de verificaci\xf3n en formato anterior. \xbfQuieres migrarla al nuevo formato con categor\xedas?"}),(0,s.jsx)("button",{onClick:O,className:"btn btn-sm bg-blue-600 text-white hover:bg-blue-700 mt-3",children:"Migrar a categor\xedas"})]})]})}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>x(!0),className:"btn btn-primary",children:"➕ Nueva categor\xeda"}),(0,s.jsx)("button",{onClick:()=>g(!0),className:"btn btn-ghost",children:"\uD83D\uDCCB Usar plantilla"}),(0,s.jsx)("button",{onClick:()=>f(!0),className:"btn btn-outline",children:"✨ Crear plantilla"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[E.map(e=>(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>T(e._id),className:"text-lg hover:bg-gray-100 rounded p-1",children:e.isCollapsed?"▶️":"\uD83D\uDD3D"}),v===e._id?(0,s.jsx)("input",{type:"text",value:N,onChange:e=>y(e.target.value),onBlur:()=>A(e._id,N),onKeyPress:t=>{"Enter"===t.key&&A(e._id,N)},className:"input text-lg font-semibold",autoFocus:!0}):(0,s.jsx)("h3",{className:"text-lg font-semibold cursor-pointer hover:text-blue-600",onClick:()=>{j(e._id),y(e.title)},children:e.title}),(0,s.jsxs)("span",{className:"text-sm text-[color:var(--muted)]",children:[e.items.filter(e=>e.done).length,"/",e.items.length]})]}),(0,s.jsx)("button",{onClick:()=>R(e._id),className:"text-red-600 hover:text-red-800 text-sm",children:"Eliminar"})]}),!e.isCollapsed&&(0,s.jsxs)("div",{className:"space-y-2",children:[e.items.map((t,a)=>(0,s.jsxs)("div",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded group",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.done,onChange:()=>J(e._id,a),className:"w-4 h-4"}),(0,s.jsx)("span",{className:"flex-1 ".concat(t.done?"line-through opacity-70":""),children:t.text}),(0,s.jsx)("button",{onClick:()=>q(e._id,a),className:"text-red-600 hover:text-red-800 text-sm opacity-0 group-hover:opacity-100",children:"✕"})]},a)),(0,s.jsxs)("div",{className:"flex gap-2 mt-3 pt-3 border-t",children:[(0,s.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),className:"flex-1 input",placeholder:"Agregar nueva tarea...",onKeyPress:t=>{"Enter"===t.key&&I(e._id)}}),(0,s.jsx)("button",{onClick:()=>I(e._id),className:"btn",children:"Agregar"})]})]})]},e._id)),0===E.length&&!P&&(0,s.jsxs)("div",{className:"text-center py-12 text-[color:var(--muted)]",children:[(0,s.jsx)("span",{className:"text-6xl",children:"\uD83D\uDCCB"}),(0,s.jsx)("div",{className:"text-lg mt-4",children:"No hay listas de verificaci\xf3n"}),(0,s.jsx)("div",{className:"text-sm mt-2",children:"Crea una nueva categor\xeda o usa una plantilla"})]})]}),h&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Nueva categor\xeda"}),(0,s.jsx)("input",{type:"text",value:m,onChange:e=>u(e.target.value),className:"w-full input mb-4",placeholder:"Ej: Obra Gris, Alambrado...",onKeyPress:e=>{"Enter"===e.key&&D()},autoFocus:!0}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{onClick:()=>x(!1),className:"btn btn-ghost",children:"Cancelar"}),(0,s.jsx)("button",{onClick:D,className:"btn btn-primary",disabled:!m.trim(),children:"Crear"})]})]})}),p&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[(0,s.jsxs)("div",{className:"p-6 border-b",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Seleccionar plantilla"}),(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)] mt-1",children:"Elige una plantilla predefinida para agregar al proyecto"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:Object.entries(L).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h4",{className:"font-medium text-blue-800 mb-3",children:t}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.map(e=>(0,s.jsxs)("div",{className:"border border-[color:var(--border)] rounded-lg p-4 hover:border-blue-300 cursor-pointer",onClick:()=>z(e),children:[(0,s.jsx)("h5",{className:"font-medium mb-2",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)] mb-3",children:e.description}),(0,s.jsxs)("div",{className:"text-xs text-blue-600",children:[e.items.length," tareas incluidas"]})]},e._id))})]},t)})}),(0,s.jsx)("div",{className:"p-6 border-t",children:(0,s.jsx)("button",{onClick:()=>g(!1),className:"btn btn-ghost",children:"Cerrar"})})]})}),b&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,s.jsxs)("div",{className:"p-6 border-b",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Crear nueva plantilla"}),(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)] mt-1",children:"Crea tu propia plantilla personalizada para reutilizar en otros proyectos"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2",children:"T\xedtulo de la plantilla *"}),(0,s.jsx)("input",{type:"text",value:C.title,onChange:e=>k(t=>({...t,title:e.target.value})),className:"w-full input",placeholder:"Ej: Instalaci\xf3n El\xe9ctrica, Acabados..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Descripci\xf3n"}),(0,s.jsx)("textarea",{value:C.description,onChange:e=>k(t=>({...t,description:e.target.value})),className:"w-full input h-20 resize-none",placeholder:"Describe brevemente para qu\xe9 sirve esta plantilla..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Categor\xeda"}),(0,s.jsx)("input",{type:"text",value:C.category,onChange:e=>k(t=>({...t,category:e.target.value})),className:"w-full input",placeholder:"Ej: Construcci\xf3n, Mantenimiento, Inspecci\xf3n..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Tareas de la plantilla *"}),(0,s.jsxs)("div",{className:"space-y-2",children:[C.items.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:e,onChange:e=>{var a;return a=e.target.value,void k(e=>({...e,items:e.items.map((e,s)=>s===t?a:e)}))},className:"flex-1 input",placeholder:"Tarea ".concat(t+1,"...")}),C.items.length>1&&(0,s.jsx)("button",{onClick:()=>{!(C.items.length<=1)&&k(e=>({...e,items:e.items.filter((e,a)=>a!==t)}))},className:"btn btn-ghost text-red-600 hover:text-red-800 px-2",children:"✕"})]},t)),(0,s.jsx)("button",{onClick:function(){k(e=>({...e,items:[...e.items,""]}))},className:"btn btn-ghost text-blue-600 hover:text-blue-800",children:"➕ Agregar tarea"})]})]})]}),(0,s.jsxs)("div",{className:"p-6 border-t flex gap-3 justify-end",children:[(0,s.jsx)("button",{onClick:()=>{f(!1),k({title:"",description:"",category:"",items:[""]})},className:"btn btn-ghost",children:"Cancelar"}),(0,s.jsx)("button",{onClick:F,className:"btn btn-primary",disabled:!C.title.trim()||0===C.items.filter(e=>e.trim()).length,children:"Crear plantilla"})]})]})})]}):(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("div",{className:"text-lg font-medium",children:"Cargando checklist..."})})})}}},e=>{e.O(0,[1026,8441,1255,7358],()=>e(e.s=7165)),_N_E=e.O()}]);