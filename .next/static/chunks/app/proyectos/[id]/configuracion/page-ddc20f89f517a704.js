(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6675],{63:(e,s,a)=>{"use strict";var t=a(7260);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"usePathname")&&a.d(s,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(s,{useSearchParams:function(){return t.useSearchParams}})},434:(e,s,a)=>{Promise.resolve().then(a.bind(a,4056))},4056:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>n});var t=a(5155),l=a(63),i=a(1026),r=a(2115);let c=async e=>{let s=await fetch(e);if(!s.ok)return null;let a=await s.text();if(!a)return null;try{return JSON.parse(a)}catch(e){return null}};function n(){var e,s,a,n,d,o,u,m,p,x,h,v;let b=(0,l.useParams)(),j=null==b?void 0:b.id,{data:N,mutate:f}=(0,i.Ay)(j?"/api/proyectos/".concat(j):null,c),{data:y}=(0,i.Ay)("/api/voluntarios",c),g=Array.isArray(y)?y:(null==y?void 0:y.items)||[],[w,D]=(0,r.useState)({}),[E,O]=(0,r.useState)(!1);function k(e){return e||0===e?new Intl.NumberFormat("es-DO",{style:"currency",currency:"DOP",minimumFractionDigits:2}).format(e):""}function S(e){let s=(null==e?void 0:e.materiales)||0,a=(null==e?void 0:e.manoDeObra)||0,t=(null==e?void 0:e.direccionTecnica)||0;return s+a+t+((null==e?void 0:e.indirectos)||0)+((null==e?void 0:e.itbis)||0)}async function T(e,s){if(N){D(s=>({...s,["presupuesto.".concat(e)]:!0}));try{let a={...N.presupuesto||{},[e]:s};"total"!==e&&(a.total=S(a));let t=await fetch("/api/proyectos/".concat(j),{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({presupuesto:a})});if(!t.ok)throw Error(await t.text());await f()}catch(e){alert("Error al actualizar presupuesto: ".concat((null==e?void 0:e.message)||e))}finally{D(s=>({...s,["presupuesto.".concat(e)]:!1}))}}}async function C(e,s){if(N){D(s=>({...s,[e]:!0}));try{let a=await fetch("/api/proyectos/".concat(j),{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({[e]:s})});if(!a.ok)throw Error(await a.text());await f()}catch(s){alert("Error al actualizar ".concat(e,": ").concat((null==s?void 0:s.message)||s))}finally{D(s=>({...s,[e]:!1}))}}}async function I(){if(N)try{let e=await fetch("/api/proyectos/".concat(j),{method:"DELETE"});if(!e.ok)throw Error(await e.text());window.location.href="/proyectos"}catch(e){alert("Error al eliminar proyecto: ".concat((null==e?void 0:e.message)||e))}}function P(e){if(!e)return"";let s=new Date(e);if(isNaN(s.getTime()))return"";let a=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),l=String(s.getDate()).padStart(2,"0");return"".concat(a,"-").concat(t,"-").concat(l)}return N?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold",children:"Configuraci\xf3n del proyecto"}),(0,t.jsx)("p",{className:"text-sm text-[color:var(--muted)] mt-1",children:"Edita la informaci\xf3n b\xe1sica del proyecto"})]}),(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Informaci\xf3n b\xe1sica"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"T\xedtulo del proyecto"}),(0,t.jsx)("input",{type:"text",defaultValue:N.titulo,className:"w-full input",onBlur:e=>{let s=e.target.value.trim();s&&s!==N.titulo&&C("titulo",s)},disabled:w.titulo})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Descripci\xf3n"}),(0,t.jsx)("textarea",{defaultValue:N.descripcion||"",className:"w-full textarea min-h-[100px]",onBlur:e=>{let s=e.target.value.trim();s!==(N.descripcion||"")&&C("descripcion",s||null)},disabled:w.descripcion,placeholder:"Describe el objetivo y alcance del proyecto..."})]})]})]}),(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Estado del proyecto"}),(0,t.jsx)("div",{className:"grid gap-3",children:[{key:"PLANIFICADO",label:"Sin empezar",icon:"⏳",color:"text-blue-600"},{key:"EN_PROGRESO",label:"En curso",icon:"➕",color:"text-indigo-700"},{key:"EN_PAUSA",label:"En pausa",icon:"⏸️",color:"text-yellow-600"},{key:"COMPLETADO",label:"Completado",icon:"✅",color:"text-green-600"}].map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-3 rounded-lg border border-[color:var(--border)] px-4 py-3 hover:bg-white/5 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:"estado",value:e.key,checked:e.key===N.estado,onChange:s=>{s.target.checked&&C("estado",e.key)},disabled:w.estado,className:"accent-[color:var(--brand)]"}),(0,t.jsx)("span",{className:e.color,children:e.icon}),(0,t.jsx)("span",{className:"text-sm font-medium",children:e.label})]},e.key))})]}),(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Cronograma"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Fecha de inicio"}),(0,t.jsx)("input",{type:"date",defaultValue:P(N.fechaInicio),className:"w-full input",onChange:e=>{C("fechaInicio",e.target.value||null)},disabled:w.fechaInicio})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Fecha de finalizaci\xf3n"}),(0,t.jsx)("input",{type:"date",defaultValue:P(N.fechaFin),className:"w-full input",onChange:e=>{C("fechaFin",e.target.value||null)},disabled:w.fechaFin})]})]})]}),(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Asignaciones"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Supervisor"}),(0,t.jsxs)("select",{value:N.voluntarioId||"",onChange:e=>{C("voluntarioId",e.target.value||null)},disabled:w.voluntarioId,className:"select w-full",children:[(0,t.jsx)("option",{value:"",children:"Sin asignar"}),g.map(e=>(0,t.jsxs)("option",{value:e._id||e.id,children:[e.nombre," ",e.apellido]},e._id||e.id))]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"T\xe9cnico"}),(0,t.jsxs)("select",{value:N.ayudanteId||"",onChange:e=>{C("ayudanteId",e.target.value||null)},disabled:w.ayudanteId,className:"select w-full",children:[(0,t.jsx)("option",{value:"",children:"Sin asignar"}),g.map(e=>(0,t.jsxs)("option",{value:e._id||e.id,children:[e.nombre," ",e.apellido]},e._id||e.id))]})]})]})]}),(0,t.jsxs)("div",{className:"card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Presupuesto aprobado"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Materiales"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[color:var(--muted)] text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",defaultValue:(null==(e=N.presupuesto)?void 0:e.materiales)||"",className:"w-full input pl-8",placeholder:"0.00",onBlur:e=>{var s;let a=parseFloat(e.target.value)||0;a!==((null==(s=N.presupuesto)?void 0:s.materiales)||0)&&T("materiales",a)},disabled:w["presupuesto.materiales"]})]}),(null==(s=N.presupuesto)?void 0:s.materiales)&&(0,t.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:k(N.presupuesto.materiales)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Mano de obra"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[color:var(--muted)] text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",defaultValue:(null==(a=N.presupuesto)?void 0:a.manoDeObra)||"",className:"w-full input pl-8",placeholder:"0.00",onBlur:e=>{var s;let a=parseFloat(e.target.value)||0;a!==((null==(s=N.presupuesto)?void 0:s.manoDeObra)||0)&&T("manoDeObra",a)},disabled:w["presupuesto.manoDeObra"]})]}),(null==(n=N.presupuesto)?void 0:n.manoDeObra)&&(0,t.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:k(N.presupuesto.manoDeObra)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Direcci\xf3n t\xe9cnica"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[color:var(--muted)] text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",defaultValue:(null==(d=N.presupuesto)?void 0:d.direccionTecnica)||"",className:"w-full input pl-8",placeholder:"0.00",onBlur:e=>{var s;let a=parseFloat(e.target.value)||0;a!==((null==(s=N.presupuesto)?void 0:s.direccionTecnica)||0)&&T("direccionTecnica",a)},disabled:w["presupuesto.direccionTecnica"]})]}),(null==(o=N.presupuesto)?void 0:o.direccionTecnica)&&(0,t.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:k(N.presupuesto.direccionTecnica)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Indirectos"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[color:var(--muted)] text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",defaultValue:(null==(u=N.presupuesto)?void 0:u.indirectos)||"",className:"w-full input pl-8",placeholder:"0.00",onBlur:e=>{var s;let a=parseFloat(e.target.value)||0;a!==((null==(s=N.presupuesto)?void 0:s.indirectos)||0)&&T("indirectos",a)},disabled:w["presupuesto.indirectos"]})]}),(null==(m=N.presupuesto)?void 0:m.indirectos)&&(0,t.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:k(N.presupuesto.indirectos)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"ITBIS"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[color:var(--muted)] text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",defaultValue:(null==(p=N.presupuesto)?void 0:p.itbis)||"",className:"w-full input pl-8",placeholder:"0.00",onBlur:e=>{var s;let a=parseFloat(e.target.value)||0;a!==((null==(s=N.presupuesto)?void 0:s.itbis)||0)&&T("itbis",a)},disabled:w["presupuesto.itbis"]})]}),(null==(x=N.presupuesto)?void 0:x.itbis)&&(0,t.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:k(N.presupuesto.itbis)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Total"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[color:var(--muted)] text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:(null==(h=N.presupuesto)?void 0:h.total)||S(N.presupuesto),className:"w-full input pl-8 bg-gray-50",placeholder:"0.00",onChange:e=>{T("total",parseFloat(e.target.value)||0)},disabled:w["presupuesto.total"]})]}),(0,t.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:k((null==(v=N.presupuesto)?void 0:v.total)||S(N.presupuesto))})]})]}),N.presupuesto&&Object.values(N.presupuesto).some(e=>e&&e>0)&&(0,t.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,t.jsx)("h3",{className:"font-medium text-blue-800 mb-3",children:"Resumen del presupuesto"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-blue-600 font-medium",children:"Materiales"}),(0,t.jsx)("div",{className:"text-blue-800",children:k(N.presupuesto.materiales)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-blue-600 font-medium",children:"M. Obra"}),(0,t.jsx)("div",{className:"text-blue-800",children:k(N.presupuesto.manoDeObra)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-blue-600 font-medium",children:"D. T\xe9cnica"}),(0,t.jsx)("div",{className:"text-blue-800",children:k(N.presupuesto.direccionTecnica)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-blue-600 font-medium",children:"Indirectos"}),(0,t.jsx)("div",{className:"text-blue-800",children:k(N.presupuesto.indirectos)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-blue-600 font-medium",children:"ITBIS"}),(0,t.jsx)("div",{className:"text-blue-800",children:k(N.presupuesto.itbis)})]}),(0,t.jsxs)("div",{className:"border-l border-blue-300 pl-4",children:[(0,t.jsx)("div",{className:"text-blue-700 font-semibold",children:"TOTAL"}),(0,t.jsx)("div",{className:"text-blue-900 font-bold text-lg",children:k(N.presupuesto.total||S(N.presupuesto))})]})]})]})]})]}),(0,t.jsxs)("div",{className:"card p-6 border-red-200",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4 text-red-800",children:"Zona de peligro"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("span",{className:"text-red-600 text-xl",children:"⚠️"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-medium text-red-800",children:"Eliminar proyecto"}),(0,t.jsx)("p",{className:"text-sm text-red-600 mt-1",children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1n todas las evidencias, listas de verificaci\xf3n y datos asociados al proyecto."})]})]})}),(0,t.jsx)("button",{onClick:()=>O(!0),className:"btn bg-red-600 text-white hover:bg-red-700",children:"Eliminar proyecto"})]})]}),E&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center p-4",children:(0,t.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDDD1️"}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"\xbfEliminar proyecto?"}),(0,t.jsxs)("p",{className:"text-sm text-[color:var(--muted)] mb-6",children:['Esta acci\xf3n eliminar\xe1 permanentemente el proyecto "',N.titulo,'" y todos sus datos asociados. No se puede deshacer.']}),(0,t.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,t.jsx)("button",{onClick:()=>O(!1),className:"btn btn-ghost",children:"Cancelar"}),(0,t.jsx)("button",{onClick:()=>{O(!1),I()},className:"btn bg-red-600 text-white hover:bg-red-700",children:"S\xed, eliminar"})]})]})})})]}):(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("div",{className:"text-lg font-medium",children:"Cargando configuraci\xf3n..."})})})}}},e=>{e.O(0,[1026,8441,1255,7358],()=>e(e.s=434)),_N_E=e.O()}]);