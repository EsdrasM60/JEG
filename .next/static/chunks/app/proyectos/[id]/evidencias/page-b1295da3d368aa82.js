(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8475],{63:(e,t,a)=>{"use strict";var s=a(7260);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},2908:(e,t,a)=>{Promise.resolve().then(a.bind(a,4230))},4230:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),i=a(63),r=a(1026),l=a(2115);let n=async e=>{let t=await fetch(e);if(!t.ok)return null;let a=await t.text();if(!a)return null;try{return JSON.parse(a)}catch(e){return null}};function c(){let e=(0,i.useParams)(),t=null==e?void 0:e.id,{data:a,mutate:c}=(0,r.Ay)(t?"/api/proyectos/".concat(t):null,n),[o,d]=(0,l.useState)([]),[u,m]=(0,l.useState)(null),h=(0,l.useRef)(null);async function x(e){let t=e.target.files;if(t&&0!==t.length){for(let e of Array.from(t)){let t=new FormData;t.append("file",e);try{let a=await fetch("/api/uploads",{method:"POST",body:t});if(!a.ok)continue;let s=await a.json(),i="/api/images/".concat(s.thumbId,"?thumb=1");d(t=>[...t,{mediaId:s.id,thumbId:s.thumbId,titulo:e.name,puntos:[],thumbUrl:i}])}catch(e){console.error("Error uploading file:",e)}}e.currentTarget.value=""}}async function p(){if(0!==o.length)try{let e=o.map(e=>({mediaId:e.mediaId,thumbId:e.thumbId,titulo:e.titulo,puntos:e.puntos})),a=await fetch("/api/proyectos/".concat(t),{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({addEvidencias:e})});if(!a.ok)throw Error(await a.text());d([]),await c()}catch(e){alert("Error al guardar evidencias: ".concat((null==e?void 0:e.message)||e))}}async function v(e){if(confirm("\xbfEliminar esta evidencia?"))try{let a=await fetch("/api/proyectos/".concat(t),{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({removeEvidenciaIds:[e]})});if(!a.ok)throw Error(await a.text());await c()}catch(e){alert("Error al eliminar evidencia: ".concat((null==e?void 0:e.message)||e))}}if(!a)return(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("div",{className:"text-lg font-medium",children:"Cargando evidencias..."})})});let f=a.evidencias||[];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Evidencias del proyecto"}),(0,s.jsxs)("p",{className:"text-sm text-[color:var(--muted)] mt-1",children:[f.length," evidencias guardadas"]})]}),(0,s.jsx)("button",{onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},className:"btn btn-primary",children:"\uD83D\uDCF8 Agregar fotos"})]}),(0,s.jsx)("input",{ref:h,type:"file",accept:"image/*",multiple:!0,onChange:x,className:"hidden"}),o.length>0&&(0,s.jsxs)("div",{className:"card p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Nuevas evidencias"}),(0,s.jsxs)("button",{onClick:p,className:"btn btn-primary",children:["Guardar ",o.length," evidencia",1!==o.length?"s":""]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map((e,t)=>(0,s.jsxs)("div",{className:"border border-[color:var(--border)] rounded-lg p-4 space-y-3",children:[(0,s.jsx)("img",{src:e.thumbUrl,alt:e.titulo||"Nueva evidencia",className:"w-full h-48 object-cover rounded"}),(0,s.jsx)("input",{value:e.titulo||"",onChange:e=>{var a;return a=e.target.value,void d(e=>e.map((e,s)=>s===t?{...e,titulo:a}:e))},className:"w-full input",placeholder:"T\xedtulo de la foto"}),(0,s.jsx)("textarea",{onChange:e=>(function(e,t){let a=t.split(/\r?\n|,|;/).map(e=>e.trim()).filter(Boolean);d(t=>t.map((t,s)=>s===e?{...t,puntos:a}:t))})(t,e.target.value),className:"w-full textarea min-h-[80px]",placeholder:"Puntos a tratar (uno por l\xednea)"}),(0,s.jsx)("button",{type:"button",className:"btn btn-ghost text-red-600",onClick:()=>{d(e=>e.filter((e,a)=>a!==t))},children:"Quitar"})]},t))})]}),f.length>0?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map((e,t)=>(0,s.jsxs)("div",{className:"card p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("img",{src:"/api/images/".concat(e.thumbId||e.mediaId,"?thumb=1"),alt:e.titulo||"Evidencia ".concat(t+1),className:"w-full h-48 object-cover rounded cursor-pointer",onClick:()=>m(e)}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors rounded flex items-center justify-center",children:(0,s.jsx)("button",{onClick:()=>m(e),className:"opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 text-black px-3 py-1 rounded text-sm",children:"Ver grande"})})]}),e.titulo&&(0,s.jsx)("h3",{className:"font-medium text-sm",children:e.titulo}),e.puntos&&e.puntos.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-[color:var(--muted)] mb-1",children:"Puntos tratados:"}),(0,s.jsx)("ul",{className:"list-disc list-inside text-sm space-y-1",children:e.puntos.map((e,t)=>(0,s.jsx)("li",{className:"text-[color:var(--muted)]",children:e},t))})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsx)("a",{href:"/api/images/".concat(e.mediaId),target:"_blank",rel:"noreferrer",className:"btn btn-ghost text-sm flex-1",children:"Descargar"}),(0,s.jsx)("button",{onClick:()=>v(e.mediaId),className:"btn btn-ghost text-red-600 text-sm",children:"Eliminar"})]})]},t))}):(0,s.jsx)("div",{className:"card p-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCF8"}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Sin evidencias a\xfan"}),(0,s.jsx)("p",{className:"text-[color:var(--muted)] mb-6",children:"Agrega fotos para documentar el progreso del proyecto"}),(0,s.jsx)("button",{onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},className:"btn btn-primary",children:"Agregar primera evidencia"})]})}),u&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",children:(0,s.jsx)("div",{className:"max-w-4xl max-h-[90vh] w-full",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsx)("h3",{className:"font-semibold",children:u.titulo||"Evidencia"}),(0,s.jsx)("button",{onClick:()=>m(null),className:"btn btn-ghost",children:"Cerrar"})]}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("img",{src:"/api/images/".concat(u.mediaId),alt:u.titulo||"Evidencia",className:"w-full max-h-[60vh] object-contain"}),u.puntos&&u.puntos.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Puntos tratados:"}),(0,s.jsx)("ul",{className:"list-disc list-inside space-y-1",children:u.puntos.map((e,t)=>(0,s.jsx)("li",{children:e},t))})]})]})]})})})]})}}},e=>{e.O(0,[1026,8441,1255,7358],()=>e(e.s=2908)),_N_E=e.O()}]);