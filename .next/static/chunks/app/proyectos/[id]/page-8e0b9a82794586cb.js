(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2097],{63:(e,s,t)=>{"use strict";var a=t(7260);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},8326:(e,s,t)=>{Promise.resolve().then(t.bind(t,8502))},8502:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(5155),c=t(63),i=t(1026);let l=async e=>{let s=await fetch(e);if(!s.ok)return null;let t=await s.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return null}};function r(){var e,s;let t=(0,c.useParams)(),r=null==t?void 0:t.id,{data:d,mutate:n}=(0,i.Ay)(r?"/api/proyectos/".concat(r):null,l),{data:o}=(0,i.Ay)("/api/voluntarios",l),m=Array.isArray(o)?o:(null==o?void 0:o.items)||[],x=new Map;function u(e){if(!e)return"—";try{return new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}).replace(/\.$/,"")}catch(s){return String(e)}}function h(e){return e?e.checklistCategories&&e.checklistCategories.length>0?e.checklistCategories.reduce((e,s)=>e+s.items.filter(e=>e.done).length,0):e.checklist?e.checklist.filter(e=>null==e?void 0:e.done).length:0:0}function v(e){return e?e.checklistCategories&&e.checklistCategories.length>0?e.checklistCategories.reduce((e,s)=>e+s.items.length,0):e.checklist?e.checklist.length:0:0}function g(e){return e||0===e?new Intl.NumberFormat("es-DO",{style:"currency",currency:"DOP",minimumFractionDigits:2}).format(e):"—"}if(m.forEach(e=>{let s=(null==e?void 0:e._id)||(null==e?void 0:e.id);s&&x.set(s,"".concat(e.nombre," ").concat(e.apellido).trim())}),!d)return(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-lg font-medium",children:"Cargando proyecto..."}),(0,a.jsx)("div",{className:"text-sm text-[color:var(--muted)] mt-1",children:"Obteniendo informaci\xf3n del proyecto"})]})});let j=function(e){let s=v(e),t=h(e);return s>0?Math.round(t/s*100):(null==e?void 0:e.estado)==="COMPLETADO"?100:25*((null==e?void 0:e.estado)==="EN_PROGRESO")}(d);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Descripci\xf3n"}),d.descripcion?(0,a.jsx)("p",{className:"text-sm text-[color:var(--muted)] leading-relaxed",children:d.descripcion}):(0,a.jsx)("p",{className:"text-sm text-[color:var(--muted)] italic",children:"Sin descripci\xf3n disponible"})]})}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Progreso"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"relative w-24 h-24 mx-auto mb-3",children:[(0,a.jsx)("div",{className:"w-24 h-24 rounded-full",style:{background:"conic-gradient(#16a34a ".concat(3.6*j,"deg, #e5e7eb 0deg)")}}),(0,a.jsxs)("div",{className:"absolute inset-0 grid place-items-center text-lg font-bold text-neutral-800",children:[j,"%"]})]}),(0,a.jsxs)("div",{className:"text-sm text-[color:var(--muted)]",children:[h(d)," de ",v(d)," completado"]})]}),function(e){if(!(null==e?void 0:e.fechaFin)||(null==e?void 0:e.estado)==="COMPLETADO")return!1;try{return new Date(e.fechaFin)<new Date}catch(e){return!1}}(d)&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)("span",{children:"⚠️"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Proyecto con retraso"})]})})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-[color:var(--muted)] mb-2",children:"Fecha de inicio"}),(0,a.jsx)("div",{className:"text-lg",children:u(d.fechaInicio)})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-[color:var(--muted)] mb-2",children:"Fecha de finalizaci\xf3n"}),(0,a.jsx)("div",{className:"text-lg",children:u(d.fechaFin)})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-[color:var(--muted)] mb-2",children:"Supervisor asignado"}),(0,a.jsx)("div",{className:"text-lg",children:d.voluntarioId?x.get(d.voluntarioId)||"Asignado":"Sin asignar"})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-[color:var(--muted)] mb-2",children:"T\xe9cnico asignado"}),(0,a.jsx)("div",{className:"text-lg",children:d.ayudanteId?x.get(d.ayudanteId)||"Asignado":"Sin asignar"})]})]}),d.presupuesto&&Object.values(d.presupuesto).some(e=>e&&e>0)&&(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Presupuesto aprobado"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,a.jsxs)("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-xs text-blue-600 font-medium mb-1",children:"Materiales"}),(0,a.jsx)("div",{className:"text-sm font-bold text-blue-800",children:g(d.presupuesto.materiales)})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-xs text-green-600 font-medium mb-1",children:"Mano de obra"}),(0,a.jsx)("div",{className:"text-sm font-bold text-green-800",children:g(d.presupuesto.manoDeObra)})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-xs text-purple-600 font-medium mb-1",children:"Direcci\xf3n t\xe9cnica"}),(0,a.jsx)("div",{className:"text-sm font-bold text-purple-800",children:g(d.presupuesto.direccionTecnica)})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-xs text-orange-600 font-medium mb-1",children:"Indirectos"}),(0,a.jsx)("div",{className:"text-sm font-bold text-orange-800",children:g(d.presupuesto.indirectos)})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-xs text-red-600 font-medium mb-1",children:"ITBIS"}),(0,a.jsx)("div",{className:"text-sm font-bold text-red-800",children:g(d.presupuesto.itbis)})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-gray-100 rounded-lg border-2 border-gray-300",children:[(0,a.jsx)("div",{className:"text-xs text-gray-700 font-semibold mb-1",children:"TOTAL"}),(0,a.jsx)("div",{className:"text-lg font-bold text-gray-900",children:g(d.presupuesto.total||function(e){let s=(null==e?void 0:e.materiales)||0,t=(null==e?void 0:e.manoDeObra)||0,a=(null==e?void 0:e.direccionTecnica)||0;return s+t+a+((null==e?void 0:e.indirectos)||0)+((null==e?void 0:e.itbis)||0)}(d.presupuesto))})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Evidencias"}),(0,a.jsxs)("span",{className:"text-sm text-[color:var(--muted)]",children:[(null==(e=d.evidencias)?void 0:e.length)||0," fotos"]})]}),d.evidencias&&d.evidencias.length>0?(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[d.evidencias.slice(0,6).map((e,s)=>(0,a.jsx)("div",{className:"aspect-square",children:(0,a.jsx)("img",{src:"/api/images/".concat(e.thumbId||e.mediaId,"?thumb=1"),alt:e.titulo||"Evidencia ".concat(s+1),className:"w-full h-full object-cover rounded"})},s)),d.evidencias.length>6&&(0,a.jsxs)("div",{className:"aspect-square bg-gray-100 rounded flex items-center justify-center text-sm text-[color:var(--muted)]",children:["+",d.evidencias.length-6]})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-[color:var(--muted)]",children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCF8"}),(0,a.jsx)("div",{className:"text-sm mt-2",children:"Sin evidencias a\xfan"})]})]}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Lista de verificaci\xf3n"}),(0,a.jsxs)("span",{className:"text-sm text-[color:var(--muted)]",children:[h(d),"/",v(d)," completado"]})]}),d.checklistCategories&&d.checklistCategories.length>0?(0,a.jsxs)("div",{className:"space-y-3",children:[d.checklistCategories.slice(0,3).map(e=>{let s=e.items.filter(e=>e.done).length,t=e.items.length,c=t>0?Math.round(s/t*100):0;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:e.title}),(0,a.jsxs)("span",{className:"text-xs text-[color:var(--muted)]",children:[s,"/",t]})]}),(0,a.jsx)("div",{className:"w-full h-1.5 bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:"".concat(c,"%")}})})]},e._id)}),d.checklistCategories.length>3&&(0,a.jsxs)("div",{className:"text-sm text-[color:var(--muted)] pt-2",children:["... y ",d.checklistCategories.length-3," categor\xedas m\xe1s"]})]}):d.checklist&&d.checklist.length>0?(0,a.jsxs)("div",{className:"space-y-2",children:[d.checklist.slice(0,5).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:!!e.done,disabled:!0,className:"cursor-not-allowed"}),(0,a.jsx)("span",{className:e.done?"line-through opacity-70":"",children:e.text})]},s)),d.checklist.length>5&&(0,a.jsxs)("div",{className:"text-sm text-[color:var(--muted)] pt-2",children:["... y ",d.checklist.length-5," elementos m\xe1s"]})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-[color:var(--muted)]",children:[(0,a.jsx)("span",{className:"text-3xl",children:"✅"}),(0,a.jsx)("div",{className:"text-sm mt-2",children:"Sin elementos en la lista"})]})]})]}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Bit\xe1cora reciente"}),(0,a.jsxs)("span",{className:"text-sm text-[color:var(--muted)]",children:[(null==(s=d.bitacora)?void 0:s.length)||0," entradas"]})]}),d.bitacora&&d.bitacora.length>0?(0,a.jsxs)("div",{className:"space-y-4",children:[d.bitacora.sort((e,s)=>new Date(s.fecha).getTime()-new Date(e.fecha).getTime()).slice(0,3).map(e=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:new Date(e.fecha).toLocaleDateString("es-ES",{weekday:"short",month:"short",day:"numeric"})}),(0,a.jsxs)("div",{className:"text-xs text-[color:var(--muted)]",children:["Por ",e.createdBy]})]}),e.fotos&&e.fotos.length>0&&(0,a.jsxs)("div",{className:"flex gap-1",children:[e.fotos.slice(0,2).map((e,s)=>(0,a.jsx)("img",{src:"/api/images/".concat(e.thumbId||e.mediaId,"?thumb=1"),alt:e.titulo||"Foto ".concat(s+1),className:"w-8 h-8 object-cover rounded"},s)),e.fotos.length>2&&(0,a.jsxs)("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center text-xs text-[color:var(--muted)]",children:["+",e.fotos.length-2]})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2",children:e.notas})]},e._id)),d.bitacora.length>3&&(0,a.jsxs)("div",{className:"text-sm text-[color:var(--muted)] text-center pt-2",children:["... y ",d.bitacora.length-3," entradas m\xe1s en bit\xe1cora"]})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-[color:var(--muted)]",children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCDD"}),(0,a.jsx)("div",{className:"text-sm mt-2",children:"Sin entradas en bit\xe1cora"})]})]})]})}}},e=>{e.O(0,[1026,8441,1255,7358],()=>e(e.s=8326)),_N_E=e.O()}]);