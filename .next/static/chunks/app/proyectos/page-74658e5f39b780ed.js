(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9741],{5844:(e,t,s)=>{Promise.resolve().then(s.bind(s,6408))},6408:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(5155),a=s(1026),i=s(2115),c=s(2619),n=s.n(c);let l=async e=>{let t=await fetch(e);if(!t.ok)return null;let s=await t.text();if(!s)return null;try{return JSON.parse(s)}catch(e){return null}};function o(){let{data:e,mutate:t}=(0,a.Ay)("/api/proyectos?page=1&pageSize=100",l),{data:s}=(0,a.Ay)("/api/voluntarios",l),[c,o]=(0,i.useState)(""),d=(0,i.useMemo)(()=>(null==e?void 0:e.items)||[],[e]),m=(0,i.useMemo)(()=>Array.isArray(s)?s:(null==s?void 0:s.items)||[],[s]),u=(0,i.useMemo)(()=>{let e=new Map;return(m||[]).forEach(t=>{let s=(null==t?void 0:t._id)||(null==t?void 0:t.id);s&&e.set(s,"".concat(t.nombre," ").concat(t.apellido).trim())}),e},[m]),x=(0,i.useMemo)(()=>{let e=c.trim().toLowerCase();return(d||[]).filter(t=>!e||(t.titulo||"").toLowerCase().includes(e)||(t.descripcion||"").toLowerCase().includes(e))},[d,c]);function h(e){if(!e)return"";try{return new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}).replace(/\.$/,"")}catch(t){return String(e)}}function f(e){return(Array.isArray(e.checklist)?e.checklist:[]).length}function p(e){return(Array.isArray(e.checklist)?e.checklist:[]).filter(e=>null==e?void 0:e.done).length}function v(e){let t=f(e),s=p(e);return t>0?Math.round(s/t*100):"COMPLETADO"===e.estado?100:25*("EN_PROGRESO"===e.estado)}async function j(e){confirm("\xbfEliminar proyecto?")&&(await fetch("/api/proyectos/".concat(e),{method:"DELETE"}),t())}return(0,r.jsxs)("section",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Proyectos"}),(0,r.jsx)(n(),{href:"/proyectos/nuevo",className:"btn btn-primary",children:"Nuevo proyecto"})]}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{className:"w-full input",placeholder:"Buscar proyectos...",value:c,onChange:e=>o(e.target.value)})}),0===x.length?(0,r.jsx)("div",{className:"text-sm text-[color:var(--muted)]",children:"Sin proyectos."}):(0,r.jsx)("ul",{className:"space-y-3",children:x.map(e=>{var t,s;return(0,r.jsx)("li",{className:"card p-4",children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-[color:var(--muted)] mb-1",children:[(0,r.jsx)("span",{children:"Proyecto"}),function(e){if(!e.fechaFin||"COMPLETADO"===e.estado)return!1;try{return new Date(e.fechaFin)<new Date}catch(e){return!1}}(e)&&(0,r.jsx)("span",{className:"badge badge-danger",children:"Con retraso"})]}),(0,r.jsx)(n(),{href:"/proyectos/".concat(e._id),className:"text-left text-lg font-semibold hover:underline truncate block",children:e.titulo}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:"Persona asignada"}),(0,r.jsx)("div",{className:"text-sm",children:e.voluntarioId?u.get(e.voluntarioId)||"Asignado":"Sin asignar"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:"Calendario"}),(0,r.jsx)("div",{className:"text-sm",children:(t=e.fechaInicio,s=e.fechaFin,t||s?t&&s?"".concat(h(t)," – ").concat(h(s)):h(t||s||""):"—")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-[color:var(--muted)]",children:"Lista de verificaci\xf3n"}),(0,r.jsxs)("div",{className:"text-sm",children:[p(e)," de ",f(e)," completado"]})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-2 min-w-[160px]",children:[(0,r.jsxs)("div",{className:"w-36 sm:w-48",children:[(0,r.jsx)("div",{className:"progress",children:(0,r.jsx)("span",{style:{width:"".concat(v(e),"%")}})}),(0,r.jsxs)("div",{className:"mt-1 text-right text-xs text-[color:var(--muted)]",children:[v(e),"%"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1 flex-wrap justify-end",children:[(0,r.jsx)("span",{className:"status-".concat(e.estado),children:e.estado.replace("_"," ")}),(0,r.jsx)(n(),{href:"/proyectos/".concat(e._id),className:"btn btn-ghost text-sm",title:"Ver proyecto",children:"Abrir"}),(0,r.jsx)(n(),{href:"/proyectos/".concat(e._id,"/configuracion"),className:"btn btn-ghost text-sm",title:"Configurar",children:"Configurar"}),(0,r.jsx)("button",{className:"btn text-sm",style:{borderColor:"#ef444455",color:"#ef4444"},title:"Eliminar",onClick:t=>{t.stopPropagation(),j(e._id)},children:"Eliminar"})]})]})]})},e._id)})})]})}}},e=>{e.O(0,[1026,2619,8441,1255,7358],()=>e(e.s=5844)),_N_E=e.O()}]);