(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8782],{7534:(e,a,s)=>{Promise.resolve().then(s.bind(s,7853))},7853:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>t});var n=s(5155),l=s(1026),r=s(2115),d=s(6489);let i=e=>fetch(e).then(e=>e.json());function t(){var e;let{data:a,mutate:s}=(0,l.Ay)("/api/admin/users",i),{data:t}=(0,d.useSession)(),o=null==t||null==(e=t.user)?void 0:e.role,c="ADMIN"===o||"COORDINADOR"===o,u="ADMIN"===o,[p,h]=(0,r.useState)(null),[m,x]=(0,r.useState)({}),[b,N]=(0,r.useState)(!1),[j,y]=(0,r.useState)({name:"",email:"",password:"",role:"VOLUNTARIO",approved:!0});async function f(e){await fetch("/api/admin/users/".concat(e,"/approve"),{method:"POST"}),s()}async function O(e,a){await fetch("/api/admin/users/".concat(e,"/role"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:a})}),s()}async function g(e){await fetch("/api/admin/users/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),h(null),x({}),s()}async function v(e){confirm("\xbfEliminar usuario?")&&(await fetch("/api/admin/users/".concat(e),{method:"DELETE"}),s())}async function C(){if(!(await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)})).ok)return void alert("Error creando usuario");N(!1),y({name:"",email:"",password:"",role:"VOLUNTARIO",approved:!0}),s()}return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Administraci\xf3n de usuarios"}),c&&(0,n.jsx)("button",{className:"px-3 py-2 rounded bg-green-600 text-white",onClick:()=>N(e=>!e),children:b?"Cancelar":"+ Nuevo usuario"})]}),b&&c&&(0,n.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-5 gap-3",children:[(0,n.jsx)("input",{className:"border rounded px-3 py-2",placeholder:"Nombre",value:j.name,onChange:e=>y({...j,name:e.target.value})}),(0,n.jsx)("input",{className:"border rounded px-3 py-2",placeholder:"Email",value:j.email,onChange:e=>y({...j,email:e.target.value})}),(0,n.jsx)("input",{className:"border rounded px-3 py-2",placeholder:"Contrase\xf1a",type:"password",value:j.password,onChange:e=>y({...j,password:e.target.value})}),(0,n.jsxs)("select",{className:"border rounded px-3 py-2",value:j.role,onChange:e=>y({...j,role:e.target.value}),children:[(0,n.jsx)("option",{value:"VOLUNTARIO",children:"VOLUNTARIO"}),(0,n.jsx)("option",{value:"COORDINADOR",children:"COORDINADOR"}),(0,n.jsx)("option",{value:"ADMIN",children:"ADMIN"})]}),(0,n.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:j.approved,onChange:e=>y({...j,approved:e.target.checked})}),"Aprobado"]}),(0,n.jsx)("div",{className:"md:col-span-5",children:(0,n.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 text-white",onClick:C,children:"Crear usuario"})})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"text-left border-b",children:[(0,n.jsx)("th",{className:"py-2",children:"Nombre"}),(0,n.jsx)("th",{children:"Email"}),(0,n.jsx)("th",{children:"Rol"}),(0,n.jsx)("th",{children:"Estado"}),(0,n.jsx)("th",{children:"Acciones"})]})}),(0,n.jsx)("tbody",{children:(null!=a?a:[]).map(e=>(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("td",{className:"py-2",children:p===e.id?(0,n.jsx)("input",{className:"border rounded px-2 py-1",defaultValue:e.name||"",onChange:e=>x(a=>({...a,name:e.target.value})),disabled:!c}):e.name||"â€”"}),(0,n.jsx)("td",{children:p===e.id?(0,n.jsx)("input",{className:"border rounded px-2 py-1",defaultValue:e.email,onChange:e=>x(a=>({...a,email:e.target.value})),disabled:!c}):e.email}),(0,n.jsx)("td",{children:(0,n.jsxs)("select",{className:"border rounded px-2 py-1",defaultValue:e.role||"VOLUNTARIO",onChange:a=>O(e.id,a.target.value),disabled:!c,children:[(0,n.jsx)("option",{children:"VOLUNTARIO"}),(0,n.jsx)("option",{children:"COORDINADOR"}),(0,n.jsx)("option",{children:"ADMIN"})]})}),(0,n.jsx)("td",{children:e.emailVerified?"Aprobado":"Pendiente"}),(0,n.jsx)("td",{className:"space-x-2 py-2",children:p===e.id?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"px-3 py-1 rounded border",onClick:()=>h(null),children:"Cancelar"}),(0,n.jsx)("button",{className:"px-3 py-1 rounded bg-blue-600 text-white",onClick:()=>g(e.id),disabled:!c,children:"Guardar"})]}):(0,n.jsxs)(n.Fragment,{children:[!e.emailVerified&&c&&(0,n.jsx)("button",{className:"px-3 py-1 rounded bg-blue-600 text-white",onClick:()=>f(e.id),children:"Aprobar"}),c&&(0,n.jsx)("button",{className:"px-3 py-1 rounded border",onClick:()=>{h(e.id),x({name:e.name||"",email:e.email})},children:"Editar"}),u&&(0,n.jsx)("button",{className:"px-3 py-1 rounded border text-red-600",onClick:()=>v(e.id),children:"Eliminar"})]})})]},e.id))})]})})]})}}},e=>{e.O(0,[1026,6489,8441,1255,7358],()=>e(e.s=7534)),_N_E=e.O()}]);