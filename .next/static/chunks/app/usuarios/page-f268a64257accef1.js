(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4634],{2211:(e,a,s)=>{"use strict";s.d(a,{default:()=>d});var l=s(5155),n=s(1026),i=s(2115),t=s(6489);let r=e=>fetch(e).then(e=>e.json());function d(){var e;let{data:a,mutate:s}=(0,n.Ay)("/api/admin/users",r),{data:d}=(0,t.useSession)(),c=null==d||null==(e=d.user)?void 0:e.role,o="ADMIN"===c||"COORDINADOR"===c,u="ADMIN"===c,[m,h]=(0,i.useState)(null),[p,x]=(0,i.useState)({}),[N,j]=(0,i.useState)(!1),[b,f]=(0,i.useState)({name:"",email:"",password:"",role:"VOLUNTARIO",approved:!0}),[v,y]=(0,i.useState)(null);async function g(e){if(o){y(e);try{let a=await fetch("/api/admin/users/".concat(e,"/approve"),{method:"POST"});if(!a.ok){let e=await a.json().catch(()=>({}));alert((null==e?void 0:e.error)||"No se pudo aprobar")}await s()}finally{y(null)}}}async function C(e,a){await fetch("/api/admin/users/".concat(e,"/role"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:a})}),s()}async function O(e){await fetch("/api/admin/users/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),h(null),x({}),s()}async function w(e,a){("ADMIN"!==a||confirm("Est\xe1s eliminando un ADMIN. \xbfContinuar?"))&&confirm("\xbfEliminar usuario?")&&(await fetch("/api/admin/users/".concat(e),{method:"DELETE"}),s())}async function A(e){if(e&&e.preventDefault(),!(await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).ok)return void alert("Error creando usuario");j(!1),f({name:"",email:"",password:"",role:"VOLUNTARIO",approved:!0}),s()}return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"Usuarios"}),o&&(0,l.jsx)("button",{className:"px-3 py-2 rounded bg-green-600 text-white",onClick:()=>j(e=>!e),children:N?"Cancelar":"+ Nuevo usuario"})]}),N&&o&&(0,l.jsxs)("div",{className:"fixed inset-0 z-50",role:"dialog","aria-modal":"true",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-black/60",onClick:()=>j(!1)}),(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"card w-[95vw] max-w-2xl max-h-[85vh] overflow-auto",children:[(0,l.jsxs)("div",{className:"px-4 py-3 card-header flex items-center gap-2",children:[(0,l.jsx)("div",{className:"font-semibold",children:"Nuevo usuario"}),(0,l.jsx)("button",{className:"ml-auto btn btn-ghost",onClick:()=>j(!1),children:"Cerrar"})]}),(0,l.jsxs)("form",{onSubmit:A,className:"p-4 grid gap-3 sm:grid-cols-2",children:[(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)("label",{className:"text-sm",children:"Nombre"}),(0,l.jsx)("input",{className:"input w-full",placeholder:"Nombre",value:b.name,onChange:e=>f({...b,name:e.target.value})})]}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)("label",{className:"text-sm",children:"Email"}),(0,l.jsx)("input",{className:"input w-full",placeholder:"Email",value:b.email,onChange:e=>f({...b,email:e.target.value})})]}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)("label",{className:"text-sm",children:"Contrase\xf1a"}),(0,l.jsx)("input",{className:"input w-full",placeholder:"Contrase\xf1a",type:"password",value:b.password,onChange:e=>f({...b,password:e.target.value})})]}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)("label",{className:"text-sm",children:"Rol"}),(0,l.jsxs)("select",{className:"input w-full",value:b.role,onChange:e=>f({...b,role:e.target.value}),children:[(0,l.jsx)("option",{value:"VOLUNTARIO",children:"VOLUNTARIO"}),(0,l.jsx)("option",{value:"COORDINADOR",children:"COORDINADOR"}),(0,l.jsx)("option",{value:"ADMIN",children:"ADMIN"})]})]}),(0,l.jsx)("div",{className:"sm:col-span-2 flex items-center gap-2 pt-1",children:(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:b.approved,onChange:e=>f({...b,approved:e.target.checked})}),"Aprobado"]})}),(0,l.jsx)("div",{className:"sm:col-span-2 text-right pt-2",children:(0,l.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Crear usuario"})})]})]})})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"text-left border-b",children:[(0,l.jsx)("th",{className:"py-2",children:"Nombre"}),(0,l.jsx)("th",{children:"Email"}),(0,l.jsx)("th",{children:"Rol"}),(0,l.jsx)("th",{children:"Estado"}),(0,l.jsx)("th",{children:"Acciones"})]})}),(0,l.jsx)("tbody",{children:(null!=a?a:[]).map(e=>(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("td",{className:"py-2",children:m===e.id?(0,l.jsx)("input",{className:"border rounded px-2 py-1",defaultValue:e.name||"",onChange:e=>x(a=>({...a,name:e.target.value})),disabled:!o}):e.name||"â€”"}),(0,l.jsx)("td",{children:m===e.id?(0,l.jsx)("input",{className:"border rounded px-2 py-1",defaultValue:e.email,onChange:e=>x(a=>({...a,email:e.target.value})),disabled:!o}):e.email}),(0,l.jsx)("td",{children:(0,l.jsxs)("select",{className:"border rounded px-2 py-1",defaultValue:e.role||"VOLUNTARIO",onChange:a=>C(e.id,a.target.value),disabled:!o,children:[(0,l.jsx)("option",{children:"VOLUNTARIO"}),(0,l.jsx)("option",{children:"COORDINADOR"}),(0,l.jsx)("option",{children:"ADMIN"})]})}),(0,l.jsx)("td",{children:e.emailVerified?"Aprobado":"Pendiente"}),(0,l.jsx)("td",{className:"space-x-2 py-2",children:m===e.id?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"px-3 py-1 rounded border",onClick:()=>h(null),children:"Cancelar"}),(0,l.jsx)("button",{className:"px-3 py-1 rounded bg-blue-600 text-white",onClick:()=>O(e.id),disabled:!o,children:"Guardar"})]}):(0,l.jsxs)(l.Fragment,{children:[!e.emailVerified&&o&&(0,l.jsx)("button",{className:"px-3 py-1 rounded text-white "+(v===e.id?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"),onClick:()=>g(e.id),disabled:v===e.id,children:v===e.id?"Aprobando...":"Aprobar"}),o&&(0,l.jsx)("button",{className:"px-3 py-1 rounded border",onClick:()=>{h(e.id),x({name:e.name||"",email:e.email})},children:"Editar"}),u&&(0,l.jsx)("button",{className:"px-3 py-1 rounded border text-red-600",onClick:()=>w(e.id,e.role),children:"Eliminar"})]})})]},e.id))})]})})]})}},8556:(e,a,s)=>{Promise.resolve().then(s.bind(s,2211))}},e=>{e.O(0,[1026,6489,8441,1255,7358],()=>e(e.s=8556)),_N_E=e.O()}]);